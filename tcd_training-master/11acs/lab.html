<!doctype html>  
<html>
	<head>
		<meta charset="utf-8">
		<title class="l_labname">Lab: Storing data in ACS</title>
		<meta name="description" content="Titanium Certified Developer, LABTITLE">
    	<meta name="author" content="Appcelerator, Inc." />
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="../presentation-engine/reveal.js/css/reset.css">
		<link rel="stylesheet" href="../presentation-engine/reveal.js/css/main.css">
		<link rel="stylesheet" href="../presentation-engine/reveal.js/lib/zenburn.css">
		<link rel="stylesheet" href="../css/presentation.css">
		<script type="text/javascript" src="../presentation-engine/js/l10n.js"></script>
		<script type="text/javascript" src="i18n/lablocalizations.js"></script>
		<style>
		html, body {
			overflow: always !important;
		}
		.slides {
			top: 40% !important;
		}
		</style>
		<script>
		function loadStyleSheet(url){
		    if(document.createStyleSheet) {
		        try {document.createStyleSheet(url);} catch (e) { }
		    }
		    else{
		        var css;
		        css         = document.createElement('link');
		        css.rel     = 'stylesheet';
		        css.type    = 'text/css';
		        css.media   = "all";
		        css.href    = url;
		        document.getElementsByTagName("head")[0].appendChild(css);
		    }
		}
		var browserlang = document.documentElement.lang || String.locale || 'en-US';
		loadStyleSheet('../css/'+browserlang+'.css');
		</script>
		<link rel="stylesheet" href="../presentation-engine/reveal.js/css/print.css" media="print">
	</head>
	
	<body>
		<div id="reveal">	
			<!-- Any section element inside of this container is displayed as a slide -->

			<!--
				LAB FILE INSTRUCTIONS:
					- Set the <title> tag to this lesson's US English title
					- Set the <meta description tag to the US English course & lesson title
					- Add one <section></section> for each slide. Slides can contain most any valid HTML
					- Each text tag (<p> or <li> or <h1> etc.) must have a class name that begins with
						"l_" and is unique. Each of those class names must be added to the i18n/localizations.js
						file and their values must be set equal to the US English version of the strings. That 
						file is used for translation and its contents OVERRIDES the text in this file.
					- Each slide must have a <div class="slidenote"></div> container, which can be empty. These
						are used for presenter notes. They also must be given unique "l_" classnames and strings
						provided in the localizations.js file.
					- Please use inline CSS on the slides to size & arrange contents.
					- Graphics should be placed in the images folder and cropped/sized appropriately.
					- Assume a 1024 x 768 display resolution
					- A link to the index.html for each lesson must be added in order to the coursename/index.html
						title slide.
			-->
			
			
<div class="slides">
<div id="labwrapper">			
<section>

<!-- YOUR LAB CONTENT GOES HERE -->
<h1 class="l_labname">Lab - Storing data in ACS</h1>
<p class="l_mission"><strong>Mission: </strong>In this lab, you will store captured fugitive data in the ACS cloud.</p>

<p class="l_specification"><strong>Specification: </strong>You will modify a partially-completed app to meet the following specs:<br/><img src='http://assets.appcelerator.com.s3.amazonaws.com/app_u/tcd_labs/Finished/acs_customobject.png' style="height: 240px;float:right;"/></p>

<ul style="width: 40%; float: left;">
	<li class="l_spec1">Extend an ACS library of functions by adding a createUser() function that will take a user-supplied name and password and create an ACS user account.</li>
	<li class="l_spec1">Add a saveFugitive() function to the library that will store a custom object containing the fugitive data in ACS.</li>
	<li class="l_spec2">Modify the login controller to call your saveFugitive() function.</li>
	<li class="l_spec3">Modify the details controller so that you call the saveFugitive() function when the fugitive is captured.</li>
</ul>

<table>
	<tr>
		<td colspan="2" class="labinstructions l_step1">1. Create a new project, making sure to cloud-enable the app. Give it a name and AppID of your choice. </td>
	</tr>
	<tr>
		<td class="tdfiller"><!-- leave empty--></td>
		<td class="labexplanations l_stepexplanation1"></td>
	</tr>
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	<tr>
		<td colspan="2" class="labinstructions l_labstep2">2. Download the starting file set from <a href='http://assets.appcelerator.com.s3.amazonaws.com/app_u/tcd_labs/Starting/11_acs.zip'>S3: 11_acs (Starting)</a>. Overwrite your new project's app directory with the files you downloaded.</td>
	</tr>
	<tr>
		<td class="tdfiller"><!-- leave empty--></td>
		<td class="labexplanations l_labstepexplanation2">We can't provide a complete app to import because the GUID would be tied to our developer account and ACS app. You must create your own app so it's associated with your account. This also means you won't be able to run the finished code without replacing the GUID and re-cloud-enabling the app. The UI has been completed for you, and shells of the functions you must write are provided.</td>
	</tr>
</table>
<table>
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep3">3. If building for Android, edit the tiapp.xml file and display the XML view. Update the default measurement unit to be "dp" rather than "system." Then, add this tag to the XML: <pre><code>&lt;property name="ti.android.threadstacksize" type="int">32768&lt;/property></code></pre> Save your changes.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation3">The app will crash with an error indicating insufficient stack space without this tag, which increases the app's stack (memory) size.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep4">4. Open lib/acs.js and examine the code that's provided for you.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation4">Code to instantiate ti.cloud and persist a user's login session are already in the file. You'll need to write the createUser() and saveFugitive() functions.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep5">5. Following the comments in the file, complete the createUser() function.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation5">It accepts three arguments: username, password, and callback (a function). Create the ACS user. If that's successful, save the session ID as an app property and set currentUser and loggedIn. Then, call callback() passing the current user object. If the create option fails, log the error to the console. Make sure loggedIn and currentUser are set back to their starting values. Call callback() passing false to it.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep6">6. Following the comments in the file, complete the saveFugitive() function.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation6">It accepts a single argument, the fugitive object. Set the ACS custom object's classname to 'fugitive' and its field equal to the fugitive object passed to this function. Log a message to the console noting success or failure.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep7">7. In FugitiveDetail.js, update the capture button's click event listener. Where noted by the comment, save the fugitive to the cloud using your saveFugitive() method. Don't forget to require in the acs library.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation7">While the acs.js file is in the lib folder, at build time it will be moved to the project's root directory. So don't include 'lib' in its path in your require() statement.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep8">8. In the Login.js controller, complete the createCallback() function. And add the createUser() call in the submit button's event click event listener.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation8">createCallback() accepts the current user object as a parameter. If it's a valid object, hide the logincontainer view. Otherwise, set the submit button's title to 'Try again...' and after one second, set it back to 'Create Account'. In the submit button's handler, call your createUser() function, passing the user's name, password, and the createCallback() function.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep9">(Optional) 9. Follow the steps in the <a href="https://wiki.appcelerator.org/display/td/10.+Geolocation+and+Mapping" target="_blank">Geolocation &amp; Mapping lab</a> to enable maps on iOS and Android. You'll need to generate a new Google Maps API key (or update an existing one to support the additional AppID), modify the tiapp.xml, and include the iOS and Android maps module. </td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation9">The app will work without this step as long as you don't try to view the map. If you do, the app will crash.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep10">10. Save changes in all the files. Then run the project in the simulator/emulator or on device.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation10">The first time you run the app, you should be prompted to create a user.</td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep11">11. After creating the user in the app, log onto the ACS control panel (visit my.appcelerator.com). Make sure you're working in the Development perspective. Then check the Users objects for your app. Your new user should be listed.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation11"></td>
</tr>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<tr>
	<td colspan="2" class="labinstructions l_labstep12">12. In the app, capture a fugitive. Then, check the ACS control panel. You should see the fugitive data listed in the Custom Objects of your app.</td>
</tr>
<tr>
	<td class="tdfiller"><!-- leave empty--></td>
	<td class="labexplanations l_labstepexplanation12"></td>
</tr>



</table>

<h2 class="l_summary">Summary</h2>
<p class="l_summarypara">In this lab, you added ACS functionality to an app. You implemented create-user functionality and stored captured fugitive data in the ACS cloud. </p>

<h2 class="l_resources">Resources</h2>

<ul>
	<li class="l_resources1">API docs: Ti.Cloud.Users: <a href='http://docs.appcelerator.com/titanium/latest/#!/api/Titanium.Cloud.Users'>http://docs.appcelerator.com/titanium/latest/#!/api/Titanium.Cloud.Users</a></li>
	<li class="l_resources2">API docs: Ti.Cloud.Objects <a href='http://docs.appcelerator.com/titanium/latest/#!/api/Titanium.Cloud.Objects'>http://docs.appcelerator.com/titanium/latest/#!/api/Titanium.Cloud.Objects</a></li>
	<li class="l_resources3">Finished code: <a href='http://assets.appcelerator.com.s3.amazonaws.com/app_u/tcd_labs/Finished/11_acs.zip'>S3: 11_acs (Finished)</a></li>
</ul>


<!-- MAKE NO CHANGES BELOW THIS LINE -->
</section>
</div>
</div>

			<!-- Appc logo and presenter notes -->
			<div id="appclogo"><a href="../index.html"><img src="../images/appu_thumb.png"/></a></div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>
			
		</div>
		
		<script src="../presentation-engine/reveal.js/js/reveal.js"></script>
		<script src="../presentation-engine/reveal.js/lib/highlight.js"></script>
		<script>
			// Parse the query string into a key/value object
			var query = {};
			location.search.replace( /[A-Z0-9]+?=(\w*)/gi, function(a) {
				query[ a.split( '=' ).shift() ] = a.split( '=' ).pop();
			} );

			Reveal.initialize({
				// Display controls in the bottom right corner
				controls: true,

				// Display a presentation progress bar
				progress: true,

				// If true; each slide will be pushed to the browser history
				history: true,

				// Flags if mouse wheel navigation should be enabled
				mouseWheel: true,

				// Apply a 3D roll to links on hover
				rollingLinks: true,

				// UI style
				theme: query.theme || 'default', // default/neon

				// Transition style
				transition: query.transition || 'default' // default/cube/page/concave/linear(2d)
			});

			hljs.initHighlightingOnLoad();
		</script>
		<script src="../presentation-engine/js/localize.js"></script>
		<script>
		var s = (function load(){
			var s = {};
			if(window.outerHeight){
				s = { w: window.outerWidth, h: window.outerHeight};
			}
			else {
				s = { w: document.body.clientWidth, h: document.body.clientHeight};
			}
			return s;
		})();
		if(s.w < 1000 || s.h < 800) {
			var slides = document.querySelectorAll( '#reveal .slides' );
			for( var i = 0, len = slides.length; i < len; i++ ) {
				slides[i].classList.add( 'smallscreen' );
		    }
		}
		</script>
	</body>
</html>
